{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import scipy\n",
    "import pandas as pd\n",
    "import math\n",
    "import random\n",
    "import sklearn\n",
    "from nltk.corpus import stopwords\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "from scipy.sparse.linalg import svds\n",
    "import matplotlib.pyplot as plt"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>timestamp</th>\n",
       "      <th>eventType</th>\n",
       "      <th>contentId</th>\n",
       "      <th>authorPersonId</th>\n",
       "      <th>authorSessionId</th>\n",
       "      <th>authorUserAgent</th>\n",
       "      <th>authorRegion</th>\n",
       "      <th>authorCountry</th>\n",
       "      <th>contentType</th>\n",
       "      <th>url</th>\n",
       "      <th>title</th>\n",
       "      <th>text</th>\n",
       "      <th>lang</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1459193988</td>\n",
       "      <td>CONTENT SHARED</td>\n",
       "      <td>-4110354420726924665</td>\n",
       "      <td>4340306774493623681</td>\n",
       "      <td>8940341205206233829</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>HTML</td>\n",
       "      <td>http://www.nytimes.com/2016/03/28/business/dea...</td>\n",
       "      <td>Ethereum, a Virtual Currency, Enables Transact...</td>\n",
       "      <td>All of this work is still very early. The firs...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1459194146</td>\n",
       "      <td>CONTENT SHARED</td>\n",
       "      <td>-7292285110016212249</td>\n",
       "      <td>4340306774493623681</td>\n",
       "      <td>8940341205206233829</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>HTML</td>\n",
       "      <td>http://cointelegraph.com/news/bitcoin-future-w...</td>\n",
       "      <td>Bitcoin Future: When GBPcoin of Branson Wins O...</td>\n",
       "      <td>The alarm clock wakes me at 8:00 with stream o...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1459194474</td>\n",
       "      <td>CONTENT SHARED</td>\n",
       "      <td>-6151852268067518688</td>\n",
       "      <td>3891637997717104548</td>\n",
       "      <td>-1457532940883382585</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>HTML</td>\n",
       "      <td>https://cloudplatform.googleblog.com/2016/03/G...</td>\n",
       "      <td>Google Data Center 360° Tour</td>\n",
       "      <td>We're excited to share the Google Data Center ...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1459194497</td>\n",
       "      <td>CONTENT SHARED</td>\n",
       "      <td>2448026894306402386</td>\n",
       "      <td>4340306774493623681</td>\n",
       "      <td>8940341205206233829</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>HTML</td>\n",
       "      <td>https://bitcoinmagazine.com/articles/ibm-wants...</td>\n",
       "      <td>IBM Wants to \"Evolve the Internet\" With Blockc...</td>\n",
       "      <td>The Aite Group projects the blockchain market ...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>1459194522</td>\n",
       "      <td>CONTENT SHARED</td>\n",
       "      <td>-2826566343807132236</td>\n",
       "      <td>4340306774493623681</td>\n",
       "      <td>8940341205206233829</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>HTML</td>\n",
       "      <td>http://www.coindesk.com/ieee-blockchain-oxford...</td>\n",
       "      <td>IEEE to Talk Blockchain at Cloud Computing Oxf...</td>\n",
       "      <td>One of the largest and oldest organizations fo...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    timestamp       eventType            contentId       authorPersonId  \\\n",
       "1  1459193988  CONTENT SHARED -4110354420726924665  4340306774493623681   \n",
       "2  1459194146  CONTENT SHARED -7292285110016212249  4340306774493623681   \n",
       "3  1459194474  CONTENT SHARED -6151852268067518688  3891637997717104548   \n",
       "4  1459194497  CONTENT SHARED  2448026894306402386  4340306774493623681   \n",
       "5  1459194522  CONTENT SHARED -2826566343807132236  4340306774493623681   \n",
       "\n",
       "       authorSessionId authorUserAgent authorRegion authorCountry contentType  \\\n",
       "1  8940341205206233829             NaN          NaN           NaN        HTML   \n",
       "2  8940341205206233829             NaN          NaN           NaN        HTML   \n",
       "3 -1457532940883382585             NaN          NaN           NaN        HTML   \n",
       "4  8940341205206233829             NaN          NaN           NaN        HTML   \n",
       "5  8940341205206233829             NaN          NaN           NaN        HTML   \n",
       "\n",
       "                                                 url  \\\n",
       "1  http://www.nytimes.com/2016/03/28/business/dea...   \n",
       "2  http://cointelegraph.com/news/bitcoin-future-w...   \n",
       "3  https://cloudplatform.googleblog.com/2016/03/G...   \n",
       "4  https://bitcoinmagazine.com/articles/ibm-wants...   \n",
       "5  http://www.coindesk.com/ieee-blockchain-oxford...   \n",
       "\n",
       "                                               title  \\\n",
       "1  Ethereum, a Virtual Currency, Enables Transact...   \n",
       "2  Bitcoin Future: When GBPcoin of Branson Wins O...   \n",
       "3                       Google Data Center 360° Tour   \n",
       "4  IBM Wants to \"Evolve the Internet\" With Blockc...   \n",
       "5  IEEE to Talk Blockchain at Cloud Computing Oxf...   \n",
       "\n",
       "                                                text lang  \n",
       "1  All of this work is still very early. The firs...   en  \n",
       "2  The alarm clock wakes me at 8:00 with stream o...   en  \n",
       "3  We're excited to share the Google Data Center ...   en  \n",
       "4  The Aite Group projects the blockchain market ...   en  \n",
       "5  One of the largest and oldest organizations fo...   en  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "articles_df = pd.read_csv('/home/anuja/Desktop/BE project/recommender/articles-sharing-and-reading-from-ci-t-deskdrop/shared_articles.csv')\n",
    "articles_df = articles_df[articles_df['eventType'] == 'CONTENT SHARED']\n",
    "articles_df.head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>timestamp</th>\n",
       "      <th>eventType</th>\n",
       "      <th>contentId</th>\n",
       "      <th>personId</th>\n",
       "      <th>sessionId</th>\n",
       "      <th>userAgent</th>\n",
       "      <th>userRegion</th>\n",
       "      <th>userCountry</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1465413032</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>-3499919498720038879</td>\n",
       "      <td>-8845298781299428018</td>\n",
       "      <td>1264196770339959068</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1465412560</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>8890720798209849691</td>\n",
       "      <td>-1032019229384696495</td>\n",
       "      <td>3621737643587579081</td>\n",
       "      <td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2...</td>\n",
       "      <td>NY</td>\n",
       "      <td>US</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1465416190</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>310515487419366995</td>\n",
       "      <td>-1130272294246983140</td>\n",
       "      <td>2631864456530402479</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1465413895</td>\n",
       "      <td>FOLLOW</td>\n",
       "      <td>310515487419366995</td>\n",
       "      <td>344280948527967603</td>\n",
       "      <td>-3167637573980064150</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1465412290</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>-7820640624231356730</td>\n",
       "      <td>-445337111692715325</td>\n",
       "      <td>5611481178424124714</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>1465413742</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>310515487419366995</td>\n",
       "      <td>-8763398617720485024</td>\n",
       "      <td>1395789369402380392</td>\n",
       "      <td>Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebK...</td>\n",
       "      <td>MG</td>\n",
       "      <td>BR</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>1465415950</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>-8864073373672512525</td>\n",
       "      <td>3609194402293569455</td>\n",
       "      <td>1143207167886864524</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>1465415066</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>-1492913151930215984</td>\n",
       "      <td>4254153380739593270</td>\n",
       "      <td>8743229464706506141</td>\n",
       "      <td>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/53...</td>\n",
       "      <td>SP</td>\n",
       "      <td>BR</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>1465413762</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>310515487419366995</td>\n",
       "      <td>344280948527967603</td>\n",
       "      <td>-3167637573980064150</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>1465413771</td>\n",
       "      <td>VIEW</td>\n",
       "      <td>3064370296170038610</td>\n",
       "      <td>3609194402293569455</td>\n",
       "      <td>1143207167886864524</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    timestamp eventType            contentId             personId  \\\n",
       "0  1465413032      VIEW -3499919498720038879 -8845298781299428018   \n",
       "1  1465412560      VIEW  8890720798209849691 -1032019229384696495   \n",
       "2  1465416190      VIEW   310515487419366995 -1130272294246983140   \n",
       "3  1465413895    FOLLOW   310515487419366995   344280948527967603   \n",
       "4  1465412290      VIEW -7820640624231356730  -445337111692715325   \n",
       "5  1465413742      VIEW   310515487419366995 -8763398617720485024   \n",
       "6  1465415950      VIEW -8864073373672512525  3609194402293569455   \n",
       "7  1465415066      VIEW -1492913151930215984  4254153380739593270   \n",
       "8  1465413762      VIEW   310515487419366995   344280948527967603   \n",
       "9  1465413771      VIEW  3064370296170038610  3609194402293569455   \n",
       "\n",
       "             sessionId                                          userAgent  \\\n",
       "0  1264196770339959068                                                NaN   \n",
       "1  3621737643587579081  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2...   \n",
       "2  2631864456530402479                                                NaN   \n",
       "3 -3167637573980064150                                                NaN   \n",
       "4  5611481178424124714                                                NaN   \n",
       "5  1395789369402380392  Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebK...   \n",
       "6  1143207167886864524                                                NaN   \n",
       "7  8743229464706506141  Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/53...   \n",
       "8 -3167637573980064150                                                NaN   \n",
       "9  1143207167886864524                                                NaN   \n",
       "\n",
       "  userRegion userCountry  \n",
       "0        NaN         NaN  \n",
       "1         NY          US  \n",
       "2        NaN         NaN  \n",
       "3        NaN         NaN  \n",
       "4        NaN         NaN  \n",
       "5         MG          BR  \n",
       "6        NaN         NaN  \n",
       "7         SP          BR  \n",
       "8        NaN         NaN  \n",
       "9        NaN         NaN  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "interactions_df = pd.read_csv('/home/anuja/Desktop/BE project/recommender/articles-sharing-and-reading-from-ci-t-deskdrop/users_interactions.csv')\n",
    "interactions_df.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "event_type_strength = {\n",
    "   'VIEW': 1.0,\n",
    "   'LIKE': 2.0, \n",
    "   'BOOKMARK': 2.5, \n",
    "   'FOLLOW': 3.0,\n",
    "   'COMMENT CREATED': 4.0,  \n",
    "}\n",
    "interactions_df['eventStrength'] = interactions_df['eventType'].apply(lambda x: event_type_strength[x])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "# users: 1895\n",
      "# users with at least 5 interactions: 1140\n"
     ]
    }
   ],
   "source": [
    "users_interactions_count_df = interactions_df.groupby(['personId', 'contentId']).size().groupby('personId').size()\n",
    "print('# users: %d' % len(users_interactions_count_df))\n",
    "users_with_enough_interactions_df = users_interactions_count_df[users_interactions_count_df >= 5].reset_index()[['personId']]\n",
    "print('# users with at least 5 interactions: %d' % len(users_with_enough_interactions_df))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "# of interactions: 72312\n",
      "# of interactions from users with at least 5 interactions: 69868\n"
     ]
    }
   ],
   "source": [
    "print('# of interactions: %d' % len(interactions_df))\n",
    "interactions_from_selected_users_df = interactions_df.merge(users_with_enough_interactions_df, \n",
    "               how = 'right',\n",
    "               left_on = 'personId',\n",
    "               right_on = 'personId')\n",
    "print('# of interactions from users with at least 5 interactions: %d' % len(interactions_from_selected_users_df))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "# of unique user/item interactions: 39106\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>personId</th>\n",
       "      <th>contentId</th>\n",
       "      <th>eventStrength</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-8949113594875411859</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-8377626164558006982</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-8208801367848627943</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-8187220755213888616</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-7423191370472335463</td>\n",
       "      <td>3.169925</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-7331393944609614247</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-6872546942144599345</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-6728844082024523434</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-6590819806697898649</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>-9223121837663643404</td>\n",
       "      <td>-6558712014192834002</td>\n",
       "      <td>1.584963</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              personId            contentId  eventStrength\n",
       "0 -9223121837663643404 -8949113594875411859       1.000000\n",
       "1 -9223121837663643404 -8377626164558006982       1.000000\n",
       "2 -9223121837663643404 -8208801367848627943       1.000000\n",
       "3 -9223121837663643404 -8187220755213888616       1.000000\n",
       "4 -9223121837663643404 -7423191370472335463       3.169925\n",
       "5 -9223121837663643404 -7331393944609614247       1.000000\n",
       "6 -9223121837663643404 -6872546942144599345       1.000000\n",
       "7 -9223121837663643404 -6728844082024523434       1.000000\n",
       "8 -9223121837663643404 -6590819806697898649       1.000000\n",
       "9 -9223121837663643404 -6558712014192834002       1.584963"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def smooth_user_preference(x):\n",
    "    return math.log(1+x, 2)\n",
    "    \n",
    "interactions_full_df = interactions_from_selected_users_df \\\n",
    "                    .groupby(['personId', 'contentId'])['eventStrength'].sum() \\\n",
    "                    .apply(smooth_user_preference).reset_index()\n",
    "print('# of unique user/item interactions: %d' % len(interactions_full_df))\n",
    "interactions_full_df.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#cross validation\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "# interactions on Train set: 31284\n",
      "# interactions on Test set: 7822\n"
     ]
    }
   ],
   "source": [
    "interactions_train_df, interactions_test_df = train_test_split(interactions_full_df,\n",
    "                                   stratify=interactions_full_df['personId'], \n",
    "                                   test_size=0.20,\n",
    "                                   random_state=42)\n",
    "\n",
    "print('# interactions on Train set: %d' % len(interactions_train_df))\n",
    "print('# interactions on Test set: %d' % len(interactions_test_df))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Indexing by personId to speed up the searches during evaluation\n",
    "interactions_full_indexed_df = interactions_full_df.set_index('personId')\n",
    "interactions_train_indexed_df = interactions_train_df.set_index('personId')\n",
    "interactions_test_indexed_df = interactions_test_df.set_index('personId')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_items_interacted(person_id, interactions_df):\n",
    "    # Get the user's data and merge in the movie information.\n",
    "    interacted_items = interactions_df.loc[person_id]['contentId']\n",
    "    return set(interacted_items if type(interacted_items) == pd.Series else [interacted_items])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Top-N accuracy metrics consts\n",
    "EVAL_RANDOM_SAMPLE_NON_INTERACTED_ITEMS = 100\n",
    "\n",
    "class ModelEvaluator:\n",
    "\n",
    "\n",
    "    def get_not_interacted_items_sample(self, person_id, sample_size, seed=42):\n",
    "        interacted_items = get_items_interacted(person_id, interactions_full_indexed_df)\n",
    "        all_items = set(articles_df['contentId'])\n",
    "        non_interacted_items = all_items - interacted_items\n",
    "\n",
    "        random.seed(seed)\n",
    "        non_interacted_items_sample = random.sample(non_interacted_items, sample_size)\n",
    "        return set(non_interacted_items_sample)\n",
    "\n",
    "    def _verify_hit_top_n(self, item_id, recommended_items, topn):        \n",
    "            try:\n",
    "                index = next(i for i, c in enumerate(recommended_items) if c == item_id)\n",
    "            except:\n",
    "                index = -1\n",
    "            hit = int(index in range(0, topn))\n",
    "            return hit, index\n",
    "\n",
    "    def evaluate_model_for_user(self, model, person_id):\n",
    "        #Getting the items in test set\n",
    "        interacted_values_testset = interactions_test_indexed_df.loc[person_id]\n",
    "        if type(interacted_values_testset['contentId']) == pd.Series:\n",
    "            person_interacted_items_testset = set(interacted_values_testset['contentId'])\n",
    "        else:\n",
    "            person_interacted_items_testset = set([int(interacted_values_testset['contentId'])])  \n",
    "        interacted_items_count_testset = len(person_interacted_items_testset) \n",
    "\n",
    "        #Getting a ranked recommendation list from a model for a given user\n",
    "        person_recs_df = model.recommend_items(person_id, \n",
    "                                               items_to_ignore=get_items_interacted(person_id, \n",
    "                                                                                    interactions_train_indexed_df), \n",
    "                                               topn=10000000000)\n",
    "\n",
    "        hits_at_5_count = 0\n",
    "        hits_at_10_count = 0\n",
    "        #For each item the user has interacted in test set\n",
    "        for item_id in person_interacted_items_testset:\n",
    "            #Getting a random sample (100) items the user has not interacted \n",
    "            #(to represent items that are assumed to be no relevant to the user)\n",
    "            non_interacted_items_sample = self.get_not_interacted_items_sample(person_id, \n",
    "                                                                          sample_size=EVAL_RANDOM_SAMPLE_NON_INTERACTED_ITEMS, \n",
    "                                                                          seed=item_id%(2**32))\n",
    "\n",
    "            #Combining the current interacted item with the 100 random items\n",
    "            items_to_filter_recs = non_interacted_items_sample.union(set([item_id]))\n",
    "\n",
    "            #Filtering only recommendations that are either the interacted item or from a random sample of 100 non-interacted items\n",
    "            valid_recs_df = person_recs_df[person_recs_df['contentId'].isin(items_to_filter_recs)]                    \n",
    "            valid_recs = valid_recs_df['contentId'].values\n",
    "            #Verifying if the current interacted item is among the Top-N recommended items\n",
    "            hit_at_5, index_at_5 = self._verify_hit_top_n(item_id, valid_recs, 5)\n",
    "            hits_at_5_count += hit_at_5\n",
    "            hit_at_10, index_at_10 = self._verify_hit_top_n(item_id, valid_recs, 10)\n",
    "            hits_at_10_count += hit_at_10\n",
    "\n",
    "        #Recall is the rate of the interacted items that are ranked among the Top-N recommended items, \n",
    "        #when mixed with a set of non-relevant items\n",
    "        recall_at_5 = hits_at_5_count / float(interacted_items_count_testset)\n",
    "        recall_at_10 = hits_at_10_count / float(interacted_items_count_testset)\n",
    "\n",
    "        person_metrics = {'hits@5_count':hits_at_5_count, \n",
    "                          'hits@10_count':hits_at_10_count, \n",
    "                          'interacted_count': interacted_items_count_testset,\n",
    "                          'recall@5': recall_at_5,\n",
    "                          'recall@10': recall_at_10}\n",
    "        return person_metrics\n",
    "\n",
    "    def evaluate_model(self, model):\n",
    "        #print('Running evaluation for users')\n",
    "        people_metrics = []\n",
    "        for idx, person_id in enumerate(list(interactions_test_indexed_df.index.unique().values)):\n",
    "            #if idx % 100 == 0 and idx > 0:\n",
    "            #    print('%d users processed' % idx)\n",
    "            person_metrics = self.evaluate_model_for_user(model, person_id)  \n",
    "            person_metrics['_person_id'] = person_id\n",
    "            people_metrics.append(person_metrics)\n",
    "        print('%d users processed' % idx)\n",
    "\n",
    "        detailed_results_df = pd.DataFrame(people_metrics) \\\n",
    "                            .sort_values('interacted_count', ascending=False)\n",
    "        \n",
    "        global_recall_at_5 = detailed_results_df['hits@5_count'].sum() / float(detailed_results_df['interacted_count'].sum())\n",
    "        global_recall_at_10 = detailed_results_df['hits@10_count'].sum() / float(detailed_results_df['interacted_count'].sum())\n",
    "        \n",
    "        global_metrics = {'modelName': model.get_model_name(),\n",
    "                          'recall@5': global_recall_at_5,\n",
    "                          'recall@10': global_recall_at_10}    \n",
    "        return global_metrics, detailed_results_df\n",
    "    \n",
    "model_evaluator = ModelEvaluator()    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>contentId</th>\n",
       "      <th>eventStrength</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>-4029704725707465084</td>\n",
       "      <td>307.733799</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>-6783772548752091658</td>\n",
       "      <td>233.762157</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>-133139342397538859</td>\n",
       "      <td>228.024567</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>-8208801367848627943</td>\n",
       "      <td>197.107608</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>-6843047699859121724</td>\n",
       "      <td>193.825208</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>8224860111193157980</td>\n",
       "      <td>189.044680</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>-2358756719610361882</td>\n",
       "      <td>183.110951</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2581138407738454418</td>\n",
       "      <td>180.282876</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>7507067965574797372</td>\n",
       "      <td>179.094002</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>1469580151036142903</td>\n",
       "      <td>170.548969</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             contentId  eventStrength\n",
       "0 -4029704725707465084     307.733799\n",
       "1 -6783772548752091658     233.762157\n",
       "2  -133139342397538859     228.024567\n",
       "3 -8208801367848627943     197.107608\n",
       "4 -6843047699859121724     193.825208\n",
       "5  8224860111193157980     189.044680\n",
       "6 -2358756719610361882     183.110951\n",
       "7  2581138407738454418     180.282876\n",
       "8  7507067965574797372     179.094002\n",
       "9  1469580151036142903     170.548969"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Computes the most popular items\n",
    "item_popularity_df = interactions_full_df.groupby('contentId')['eventStrength'].sum().sort_values(ascending=False).reset_index()\n",
    "item_popularity_df.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "class PopularityRecommender:\n",
    "    \n",
    "    MODEL_NAME = 'Popularity'\n",
    "    \n",
    "    def __init__(self, popularity_df, items_df=None):\n",
    "        self.popularity_df = popularity_df\n",
    "        self.items_df = items_df\n",
    "        \n",
    "    def get_model_name(self):\n",
    "        return self.MODEL_NAME\n",
    "        \n",
    "    def recommend_items(self, user_id, items_to_ignore=[], topn=10, verbose=False):\n",
    "        # Recommend the more popular items that the user hasn't seen yet.\n",
    "        recommendations_df = self.popularity_df[~self.popularity_df['contentId'].isin(items_to_ignore)] \\\n",
    "                               .sort_values('eventStrength', ascending = False) \\\n",
    "                               .head(topn)\n",
    "\n",
    "        if verbose:\n",
    "            if self.items_df is None:\n",
    "                raise Exception('\"items_df\" is required in verbose mode')\n",
    "\n",
    "            recommendations_df = recommendations_df.merge(self.items_df, how = 'left', \n",
    "                                                          left_on = 'contentId', \n",
    "                                                          right_on = 'contentId')[['eventStrength', 'contentId', 'title', 'url', 'lang']]\n",
    "\n",
    "\n",
    "        return recommendations_df\n",
    "    \n",
    "popularity_model = PopularityRecommender(item_popularity_df, articles_df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Evaluating Popularity recommendation model...\n",
      "1139 users processed\n",
      "\n",
      "Global metrics:\n",
      "{'recall@10': 0.37138839171567373, 'recall@5': 0.24316031705446178, 'modelName': 'Popularity'}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>_person_id</th>\n",
       "      <th>hits@10_count</th>\n",
       "      <th>hits@5_count</th>\n",
       "      <th>interacted_count</th>\n",
       "      <th>recall@10</th>\n",
       "      <th>recall@5</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>76</th>\n",
       "      <td>3609194402293569455</td>\n",
       "      <td>51</td>\n",
       "      <td>24</td>\n",
       "      <td>192</td>\n",
       "      <td>0.265625</td>\n",
       "      <td>0.125000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>-2626634673110551643</td>\n",
       "      <td>25</td>\n",
       "      <td>13</td>\n",
       "      <td>134</td>\n",
       "      <td>0.186567</td>\n",
       "      <td>0.097015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>-1032019229384696495</td>\n",
       "      <td>22</td>\n",
       "      <td>12</td>\n",
       "      <td>130</td>\n",
       "      <td>0.169231</td>\n",
       "      <td>0.092308</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>-1443636648652872475</td>\n",
       "      <td>7</td>\n",
       "      <td>4</td>\n",
       "      <td>117</td>\n",
       "      <td>0.059829</td>\n",
       "      <td>0.034188</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>82</th>\n",
       "      <td>-2979881261169775358</td>\n",
       "      <td>41</td>\n",
       "      <td>26</td>\n",
       "      <td>88</td>\n",
       "      <td>0.465909</td>\n",
       "      <td>0.295455</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>161</th>\n",
       "      <td>-3596626804281480007</td>\n",
       "      <td>20</td>\n",
       "      <td>13</td>\n",
       "      <td>80</td>\n",
       "      <td>0.250000</td>\n",
       "      <td>0.162500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>1116121227607581999</td>\n",
       "      <td>32</td>\n",
       "      <td>19</td>\n",
       "      <td>73</td>\n",
       "      <td>0.438356</td>\n",
       "      <td>0.260274</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>81</th>\n",
       "      <td>692689608292948411</td>\n",
       "      <td>23</td>\n",
       "      <td>14</td>\n",
       "      <td>69</td>\n",
       "      <td>0.333333</td>\n",
       "      <td>0.202899</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>106</th>\n",
       "      <td>-9016528795238256703</td>\n",
       "      <td>21</td>\n",
       "      <td>14</td>\n",
       "      <td>69</td>\n",
       "      <td>0.304348</td>\n",
       "      <td>0.202899</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>3636910968448833585</td>\n",
       "      <td>28</td>\n",
       "      <td>24</td>\n",
       "      <td>68</td>\n",
       "      <td>0.411765</td>\n",
       "      <td>0.352941</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              _person_id  hits@10_count  hits@5_count  interacted_count  \\\n",
       "76   3609194402293569455             51            24               192   \n",
       "17  -2626634673110551643             25            13               134   \n",
       "16  -1032019229384696495             22            12               130   \n",
       "10  -1443636648652872475              7             4               117   \n",
       "82  -2979881261169775358             41            26                88   \n",
       "161 -3596626804281480007             20            13                80   \n",
       "65   1116121227607581999             32            19                73   \n",
       "81    692689608292948411             23            14                69   \n",
       "106 -9016528795238256703             21            14                69   \n",
       "52   3636910968448833585             28            24                68   \n",
       "\n",
       "     recall@10  recall@5  \n",
       "76    0.265625  0.125000  \n",
       "17    0.186567  0.097015  \n",
       "16    0.169231  0.092308  \n",
       "10    0.059829  0.034188  \n",
       "82    0.465909  0.295455  \n",
       "161   0.250000  0.162500  \n",
       "65    0.438356  0.260274  \n",
       "81    0.333333  0.202899  \n",
       "106   0.304348  0.202899  \n",
       "52    0.411765  0.352941  "
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print('Evaluating Popularity recommendation model...')\n",
    "pop_global_metrics, pop_detailed_results_df = model_evaluator.evaluate_model(popularity_model)\n",
    "print('\\nGlobal metrics:\\n%s' % pop_global_metrics)\n",
    "pop_detailed_results_df.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<3047x5000 sparse matrix of type '<class 'numpy.float64'>'\n",
       "\twith 638928 stored elements in Compressed Sparse Row format>"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Ignoring stopwords (words with no semantics) from English and Portuguese (as we have a corpus with mixed languages)\n",
    "stopwords_list = stopwords.words('english') + stopwords.words('portuguese')\n",
    "\n",
    "#Trains a model whose vectors size is 5000, composed by the main unigrams and bigrams found in the corpus, ignoring stopwords\n",
    "vectorizer = TfidfVectorizer(analyzer='word',\n",
    "                     ngram_range=(1, 2),\n",
    "                     min_df=0.003,\n",
    "                     max_df=0.5,\n",
    "                     max_features=5000,\n",
    "                     stop_words=stopwords_list)\n",
    "\n",
    "item_ids = articles_df['contentId'].tolist()\n",
    "tfidf_matrix = vectorizer.fit_transform(articles_df['title'] + \"\" + articles_df['text'])\n",
    "tfidf_feature_names = vectorizer.get_feature_names()\n",
    "tfidf_matrix"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_item_profile(item_id):\n",
    "    idx = item_ids.index(item_id)\n",
    "    item_profile = tfidf_matrix[idx:idx+1]\n",
    "    return item_profile\n",
    "\n",
    "def get_item_profiles(ids):\n",
    "    item_profiles_list = [get_item_profile(x) for x in ids]\n",
    "    item_profiles = scipy.sparse.vstack(item_profiles_list)\n",
    "    return item_profiles\n",
    "\n",
    "def build_users_profile(person_id, interactions_indexed_df):\n",
    "    interactions_person_df = interactions_indexed_df.loc[person_id]\n",
    "    user_item_profiles = get_item_profiles(interactions_person_df['contentId'])\n",
    "    \n",
    "    user_item_strengths = np.array(interactions_person_df['eventStrength']).reshape(-1,1)\n",
    "    #Weighted average of item profiles by the interactions strength\n",
    "    user_item_strengths_weighted_avg = np.sum(user_item_profiles.multiply(user_item_strengths), axis=0) / np.sum(user_item_strengths)\n",
    "    user_profile_norm = sklearn.preprocessing.normalize(user_item_strengths_weighted_avg)\n",
    "    return user_profile_norm\n",
    "\n",
    "def build_users_profiles(): \n",
    "    interactions_indexed_df = interactions_full_df[interactions_full_df['contentId'] \\\n",
    "                                                   .isin(articles_df['contentId'])].set_index('personId')\n",
    "    user_profiles = {}\n",
    "    for person_id in interactions_indexed_df.index.unique():\n",
    "        user_profiles[person_id] = build_users_profile(person_id, interactions_indexed_df)\n",
    "    return user_profiles\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "1140"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "user_profiles = build_users_profiles()\n",
    "len(user_profiles)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(1, 5000)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>token</th>\n",
       "      <th>relevance</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>learning</td>\n",
       "      <td>0.305655</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>machine learning</td>\n",
       "      <td>0.255557</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>machine</td>\n",
       "      <td>0.246095</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>google</td>\n",
       "      <td>0.208590</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>data</td>\n",
       "      <td>0.172509</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ai</td>\n",
       "      <td>0.136818</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>algorithms</td>\n",
       "      <td>0.102396</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>graph</td>\n",
       "      <td>0.098438</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>like</td>\n",
       "      <td>0.096970</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>language</td>\n",
       "      <td>0.083993</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>people</td>\n",
       "      <td>0.077122</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>use</td>\n",
       "      <td>0.073203</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>models</td>\n",
       "      <td>0.073168</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>deep</td>\n",
       "      <td>0.072377</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>deep learning</td>\n",
       "      <td>0.071892</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>research</td>\n",
       "      <td>0.071503</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>company</td>\n",
       "      <td>0.071293</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>intelligence</td>\n",
       "      <td>0.070650</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>human</td>\n",
       "      <td>0.070126</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>artificial</td>\n",
       "      <td>0.068062</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               token  relevance\n",
       "0           learning   0.305655\n",
       "1   machine learning   0.255557\n",
       "2            machine   0.246095\n",
       "3             google   0.208590\n",
       "4               data   0.172509\n",
       "5                 ai   0.136818\n",
       "6         algorithms   0.102396\n",
       "7              graph   0.098438\n",
       "8               like   0.096970\n",
       "9           language   0.083993\n",
       "10            people   0.077122\n",
       "11               use   0.073203\n",
       "12            models   0.073168\n",
       "13              deep   0.072377\n",
       "14     deep learning   0.071892\n",
       "15          research   0.071503\n",
       "16           company   0.071293\n",
       "17      intelligence   0.070650\n",
       "18             human   0.070126\n",
       "19        artificial   0.068062"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "myprofile = user_profiles[-1479311724257856983]\n",
    "print(myprofile.shape)\n",
    "pd.DataFrame(sorted(zip(tfidf_feature_names, \n",
    "                        user_profiles[-1479311724257856983].flatten().tolist()), key=lambda x: -x[1])[:20],\n",
    "             columns=['token', 'relevance'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "class ContentBasedRecommender:\n",
    "    \n",
    "    MODEL_NAME = 'Content-Based'\n",
    "    \n",
    "    def __init__(self, items_df=None):\n",
    "        self.item_ids = item_ids\n",
    "        self.items_df = items_df\n",
    "        \n",
    "    def get_model_name(self):\n",
    "        return self.MODEL_NAME\n",
    "        \n",
    "    def _get_similar_items_to_user_profile(self, person_id, topn=1000):\n",
    "        #Computes the cosine similarity between the user profile and all item profiles\n",
    "        cosine_similarities = cosine_similarity(user_profiles[person_id], tfidf_matrix)\n",
    "        #Gets the top similar items\n",
    "        similar_indices = cosine_similarities.argsort().flatten()[-topn:]\n",
    "        #Sort the similar items by similarity\n",
    "        similar_items = sorted([(item_ids[i], cosine_similarities[0,i]) for i in similar_indices], key=lambda x: -x[1])\n",
    "        return similar_items\n",
    "        \n",
    "    def recommend_items(self, user_id, items_to_ignore=[], topn=10, verbose=False):\n",
    "        similar_items = self._get_similar_items_to_user_profile(user_id)\n",
    "        #Ignores items the user has already interacted\n",
    "        similar_items_filtered = list(filter(lambda x: x[0] not in items_to_ignore, similar_items))\n",
    "        \n",
    "        recommendations_df = pd.DataFrame(similar_items_filtered, columns=['contentId', 'recStrength']) \\\n",
    "                                    .head(topn)\n",
    "\n",
    "        if verbose:\n",
    "            if self.items_df is None:\n",
    "                raise Exception('\"items_df\" is required in verbose mode')\n",
    "\n",
    "            recommendations_df = recommendations_df.merge(self.items_df, how = 'left', \n",
    "                                                          left_on = 'contentId', \n",
    "                                                          right_on = 'contentId')[['recStrength', 'contentId', 'title', 'url', 'lang']]\n",
    "\n",
    "\n",
    "        return recommendations_df\n",
    "    \n",
    "content_based_recommender_model = ContentBasedRecommender(articles_df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Evaluating Content-Based Filtering model...\n",
      "1139 users processed\n",
      "\n",
      "Global metrics:\n",
      "{'recall@10': 0.52429046279723857, 'recall@5': 0.41485553566862693, 'modelName': 'Content-Based'}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>_person_id</th>\n",
       "      <th>hits@10_count</th>\n",
       "      <th>hits@5_count</th>\n",
       "      <th>interacted_count</th>\n",
       "      <th>recall@10</th>\n",
       "      <th>recall@5</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>76</th>\n",
       "      <td>3609194402293569455</td>\n",
       "      <td>25</td>\n",
       "      <td>15</td>\n",
       "      <td>192</td>\n",
       "      <td>0.130208</td>\n",
       "      <td>0.078125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>-2626634673110551643</td>\n",
       "      <td>32</td>\n",
       "      <td>21</td>\n",
       "      <td>134</td>\n",
       "      <td>0.238806</td>\n",
       "      <td>0.156716</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>-1032019229384696495</td>\n",
       "      <td>38</td>\n",
       "      <td>22</td>\n",
       "      <td>130</td>\n",
       "      <td>0.292308</td>\n",
       "      <td>0.169231</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>-1443636648652872475</td>\n",
       "      <td>53</td>\n",
       "      <td>33</td>\n",
       "      <td>117</td>\n",
       "      <td>0.452991</td>\n",
       "      <td>0.282051</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>82</th>\n",
       "      <td>-2979881261169775358</td>\n",
       "      <td>19</td>\n",
       "      <td>9</td>\n",
       "      <td>88</td>\n",
       "      <td>0.215909</td>\n",
       "      <td>0.102273</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>161</th>\n",
       "      <td>-3596626804281480007</td>\n",
       "      <td>25</td>\n",
       "      <td>15</td>\n",
       "      <td>80</td>\n",
       "      <td>0.312500</td>\n",
       "      <td>0.187500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>1116121227607581999</td>\n",
       "      <td>14</td>\n",
       "      <td>10</td>\n",
       "      <td>73</td>\n",
       "      <td>0.191781</td>\n",
       "      <td>0.136986</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>81</th>\n",
       "      <td>692689608292948411</td>\n",
       "      <td>19</td>\n",
       "      <td>12</td>\n",
       "      <td>69</td>\n",
       "      <td>0.275362</td>\n",
       "      <td>0.173913</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>106</th>\n",
       "      <td>-9016528795238256703</td>\n",
       "      <td>12</td>\n",
       "      <td>6</td>\n",
       "      <td>69</td>\n",
       "      <td>0.173913</td>\n",
       "      <td>0.086957</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>3636910968448833585</td>\n",
       "      <td>11</td>\n",
       "      <td>5</td>\n",
       "      <td>68</td>\n",
       "      <td>0.161765</td>\n",
       "      <td>0.073529</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              _person_id  hits@10_count  hits@5_count  interacted_count  \\\n",
       "76   3609194402293569455             25            15               192   \n",
       "17  -2626634673110551643             32            21               134   \n",
       "16  -1032019229384696495             38            22               130   \n",
       "10  -1443636648652872475             53            33               117   \n",
       "82  -2979881261169775358             19             9                88   \n",
       "161 -3596626804281480007             25            15                80   \n",
       "65   1116121227607581999             14            10                73   \n",
       "81    692689608292948411             19            12                69   \n",
       "106 -9016528795238256703             12             6                69   \n",
       "52   3636910968448833585             11             5                68   \n",
       "\n",
       "     recall@10  recall@5  \n",
       "76    0.130208  0.078125  \n",
       "17    0.238806  0.156716  \n",
       "16    0.292308  0.169231  \n",
       "10    0.452991  0.282051  \n",
       "82    0.215909  0.102273  \n",
       "161   0.312500  0.187500  \n",
       "65    0.191781  0.136986  \n",
       "81    0.275362  0.173913  \n",
       "106   0.173913  0.086957  \n",
       "52    0.161765  0.073529  "
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print('Evaluating Content-Based Filtering model...')\n",
    "cb_global_metrics, cb_detailed_results_df = model_evaluator.evaluate_model(content_based_recommender_model)\n",
    "print('\\nGlobal metrics:\\n%s' % cb_global_metrics)\n",
    "cb_detailed_results_df.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>contentId</th>\n",
       "      <th>-9222795471790223670</th>\n",
       "      <th>-9216926795620865886</th>\n",
       "      <th>-9194572880052200111</th>\n",
       "      <th>-9192549002213406534</th>\n",
       "      <th>-9190737901804729417</th>\n",
       "      <th>-9189659052158407108</th>\n",
       "      <th>-9176143510534135851</th>\n",
       "      <th>-9172673334835262304</th>\n",
       "      <th>-9171475473795142532</th>\n",
       "      <th>-9166778629773133902</th>\n",
       "      <th>...</th>\n",
       "      <th>9191014301634017491</th>\n",
       "      <th>9207286802575546269</th>\n",
       "      <th>9208127165664287660</th>\n",
       "      <th>9209629151177723638</th>\n",
       "      <th>9209886322932807692</th>\n",
       "      <th>9213260650272029784</th>\n",
       "      <th>9215261273565326920</th>\n",
       "      <th>9217155070834564627</th>\n",
       "      <th>9220445660318725468</th>\n",
       "      <th>9222265156747237864</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>personId</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>-9223121837663643404</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9212075797126931087</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9207251133131336884</th>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9199575329909162940</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9196668942822132778</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9188188261933657343</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9172914609055320039</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9156344805277471150</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9120685872592674274</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9109785559521267180</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10 rows × 2926 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "contentId             -9222795471790223670  -9216926795620865886  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   2.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId             -9194572880052200111  -9192549002213406534  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId             -9190737901804729417  -9189659052158407108  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId             -9176143510534135851  -9172673334835262304  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId             -9171475473795142532  -9166778629773133902  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId                     ...            9191014301634017491  \\\n",
       "personId                      ...                                  \n",
       "-9223121837663643404          ...                            0.0   \n",
       "-9212075797126931087          ...                            0.0   \n",
       "-9207251133131336884          ...                            0.0   \n",
       "-9199575329909162940          ...                            0.0   \n",
       "-9196668942822132778          ...                            0.0   \n",
       "-9188188261933657343          ...                            0.0   \n",
       "-9172914609055320039          ...                            0.0   \n",
       "-9156344805277471150          ...                            0.0   \n",
       "-9120685872592674274          ...                            0.0   \n",
       "-9109785559521267180          ...                            0.0   \n",
       "\n",
       "contentId              9207286802575546269   9208127165664287660  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId              9209629151177723638   9209886322932807692  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId              9213260650272029784   9215261273565326920  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId              9217155070834564627   9220445660318725468  \\\n",
       "personId                                                           \n",
       "-9223121837663643404                   0.0                   0.0   \n",
       "-9212075797126931087                   0.0                   0.0   \n",
       "-9207251133131336884                   0.0                   0.0   \n",
       "-9199575329909162940                   0.0                   0.0   \n",
       "-9196668942822132778                   0.0                   0.0   \n",
       "-9188188261933657343                   0.0                   0.0   \n",
       "-9172914609055320039                   0.0                   0.0   \n",
       "-9156344805277471150                   0.0                   0.0   \n",
       "-9120685872592674274                   0.0                   0.0   \n",
       "-9109785559521267180                   0.0                   0.0   \n",
       "\n",
       "contentId              9222265156747237864  \n",
       "personId                                    \n",
       "-9223121837663643404                   0.0  \n",
       "-9212075797126931087                   0.0  \n",
       "-9207251133131336884                   0.0  \n",
       "-9199575329909162940                   0.0  \n",
       "-9196668942822132778                   0.0  \n",
       "-9188188261933657343                   0.0  \n",
       "-9172914609055320039                   0.0  \n",
       "-9156344805277471150                   0.0  \n",
       "-9120685872592674274                   0.0  \n",
       "-9109785559521267180                   0.0  \n",
       "\n",
       "[10 rows x 2926 columns]"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Creating a sparse pivot table with users in rows and items in columns\n",
    "users_items_pivot_matrix_df = interactions_train_df.pivot(index='personId', \n",
    "                                                          columns='contentId', \n",
    "                                                          values='eventStrength').fillna(0)\n",
    "\n",
    "users_items_pivot_matrix_df.head(10)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n",
       "       [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n",
       "       [ 0.,  2.,  0., ...,  0.,  0.,  0.],\n",
       "       ..., \n",
       "       [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n",
       "       [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n",
       "       [ 0.,  0.,  0., ...,  0.,  0.,  0.]])"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "users_items_pivot_matrix = users_items_pivot_matrix_df.as_matrix()\n",
    "users_items_pivot_matrix[:10]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[-9223121837663643404,\n",
       " -9212075797126931087,\n",
       " -9207251133131336884,\n",
       " -9199575329909162940,\n",
       " -9196668942822132778,\n",
       " -9188188261933657343,\n",
       " -9172914609055320039,\n",
       " -9156344805277471150,\n",
       " -9120685872592674274,\n",
       " -9109785559521267180]"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "users_ids = list(users_items_pivot_matrix_df.index)\n",
    "users_ids[:10]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [],
   "source": [
    "#The number of factors to factor the user-item matrix.\n",
    "NUMBER_OF_FACTORS_MF = 15\n",
    "#Performs matrix factorization of the original user item matrix\n",
    "U, sigma, Vt = svds(users_items_pivot_matrix, k = NUMBER_OF_FACTORS_MF)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1140, 15)"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "U.shape\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(15, 2926)"
      ]
     },
     "execution_count": 31,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "Vt.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(15, 15)"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sigma = np.diag(sigma)\n",
    "sigma.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[ 0.01039915,  0.00081872, -0.01725263, ...,  0.00140708,\n",
       "         0.0110647 ,  0.00226063],\n",
       "       [-0.00019285, -0.00031318, -0.00264624, ...,  0.00251658,\n",
       "         0.00017609, -0.00189488],\n",
       "       [-0.01254721,  0.0065947 , -0.00590676, ...,  0.00698975,\n",
       "        -0.01015696,  0.01154572],\n",
       "       ..., \n",
       "       [-0.02995379,  0.00805715, -0.01846307, ..., -0.01083078,\n",
       "        -0.00118591,  0.0096798 ],\n",
       "       [-0.01845505,  0.00467019,  0.01219602, ...,  0.00409507,\n",
       "         0.00019482, -0.00752562],\n",
       "       [-0.01506374,  0.00327732,  0.13391269, ..., -0.01191815,\n",
       "         0.06422074,  0.01303244]])"
      ]
     },
     "execution_count": 33,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "all_user_predicted_ratings = np.dot(np.dot(U, sigma), Vt) \n",
    "all_user_predicted_ratings"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>-9223121837663643404</th>\n",
       "      <th>-9212075797126931087</th>\n",
       "      <th>-9207251133131336884</th>\n",
       "      <th>-9199575329909162940</th>\n",
       "      <th>-9196668942822132778</th>\n",
       "      <th>-9188188261933657343</th>\n",
       "      <th>-9172914609055320039</th>\n",
       "      <th>-9156344805277471150</th>\n",
       "      <th>-9120685872592674274</th>\n",
       "      <th>-9109785559521267180</th>\n",
       "      <th>...</th>\n",
       "      <th>9105269044962898535</th>\n",
       "      <th>9109075639526981934</th>\n",
       "      <th>9135582630122950040</th>\n",
       "      <th>9137372837662939523</th>\n",
       "      <th>9148269800512008413</th>\n",
       "      <th>9165571805999894845</th>\n",
       "      <th>9187866633451383747</th>\n",
       "      <th>9191849144618614467</th>\n",
       "      <th>9199170757466086545</th>\n",
       "      <th>9210530975708218054</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>contentId</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>-9222795471790223670</th>\n",
       "      <td>0.010399</td>\n",
       "      <td>-0.000193</td>\n",
       "      <td>-0.012547</td>\n",
       "      <td>0.052958</td>\n",
       "      <td>-0.010035</td>\n",
       "      <td>-0.005412</td>\n",
       "      <td>-0.003918</td>\n",
       "      <td>0.049302</td>\n",
       "      <td>-0.013458</td>\n",
       "      <td>-0.020052</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.005306</td>\n",
       "      <td>-0.089463</td>\n",
       "      <td>-0.000048</td>\n",
       "      <td>0.015023</td>\n",
       "      <td>0.020953</td>\n",
       "      <td>-0.009394</td>\n",
       "      <td>-0.019114</td>\n",
       "      <td>-0.029954</td>\n",
       "      <td>-0.018455</td>\n",
       "      <td>-0.015064</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9216926795620865886</th>\n",
       "      <td>0.000819</td>\n",
       "      <td>-0.000313</td>\n",
       "      <td>0.006595</td>\n",
       "      <td>-0.000649</td>\n",
       "      <td>0.000151</td>\n",
       "      <td>0.000338</td>\n",
       "      <td>0.000197</td>\n",
       "      <td>0.000861</td>\n",
       "      <td>0.002341</td>\n",
       "      <td>0.001765</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000095</td>\n",
       "      <td>0.013915</td>\n",
       "      <td>0.000506</td>\n",
       "      <td>0.001460</td>\n",
       "      <td>0.014863</td>\n",
       "      <td>0.000940</td>\n",
       "      <td>0.002391</td>\n",
       "      <td>0.008057</td>\n",
       "      <td>0.004670</td>\n",
       "      <td>0.003277</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9194572880052200111</th>\n",
       "      <td>-0.017253</td>\n",
       "      <td>-0.002646</td>\n",
       "      <td>-0.005907</td>\n",
       "      <td>-0.003666</td>\n",
       "      <td>0.021300</td>\n",
       "      <td>-0.001278</td>\n",
       "      <td>0.029100</td>\n",
       "      <td>-0.014730</td>\n",
       "      <td>-0.023410</td>\n",
       "      <td>0.004950</td>\n",
       "      <td>...</td>\n",
       "      <td>0.011529</td>\n",
       "      <td>0.046012</td>\n",
       "      <td>0.010485</td>\n",
       "      <td>0.018768</td>\n",
       "      <td>0.150362</td>\n",
       "      <td>0.019052</td>\n",
       "      <td>0.023870</td>\n",
       "      <td>-0.018463</td>\n",
       "      <td>0.012196</td>\n",
       "      <td>0.133913</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9192549002213406534</th>\n",
       "      <td>0.035081</td>\n",
       "      <td>0.000391</td>\n",
       "      <td>-0.029046</td>\n",
       "      <td>-0.007702</td>\n",
       "      <td>0.017615</td>\n",
       "      <td>0.005496</td>\n",
       "      <td>0.013435</td>\n",
       "      <td>0.057563</td>\n",
       "      <td>0.047532</td>\n",
       "      <td>0.004209</td>\n",
       "      <td>...</td>\n",
       "      <td>0.020149</td>\n",
       "      <td>0.260317</td>\n",
       "      <td>0.007923</td>\n",
       "      <td>-0.008079</td>\n",
       "      <td>0.034164</td>\n",
       "      <td>0.011558</td>\n",
       "      <td>0.013793</td>\n",
       "      <td>-0.010138</td>\n",
       "      <td>0.025703</td>\n",
       "      <td>0.095753</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9190737901804729417</th>\n",
       "      <td>0.019939</td>\n",
       "      <td>-0.004799</td>\n",
       "      <td>0.006684</td>\n",
       "      <td>0.006363</td>\n",
       "      <td>-0.001997</td>\n",
       "      <td>0.002356</td>\n",
       "      <td>0.003876</td>\n",
       "      <td>0.004118</td>\n",
       "      <td>-0.027098</td>\n",
       "      <td>0.019793</td>\n",
       "      <td>...</td>\n",
       "      <td>0.003719</td>\n",
       "      <td>0.004478</td>\n",
       "      <td>0.001917</td>\n",
       "      <td>0.000341</td>\n",
       "      <td>-0.034535</td>\n",
       "      <td>-0.001160</td>\n",
       "      <td>0.001307</td>\n",
       "      <td>0.002957</td>\n",
       "      <td>0.005991</td>\n",
       "      <td>-0.015662</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9189659052158407108</th>\n",
       "      <td>0.008661</td>\n",
       "      <td>0.006604</td>\n",
       "      <td>0.001463</td>\n",
       "      <td>-0.002918</td>\n",
       "      <td>0.008551</td>\n",
       "      <td>-0.001637</td>\n",
       "      <td>0.005443</td>\n",
       "      <td>0.002193</td>\n",
       "      <td>0.023148</td>\n",
       "      <td>0.021311</td>\n",
       "      <td>...</td>\n",
       "      <td>0.024496</td>\n",
       "      <td>0.090091</td>\n",
       "      <td>-0.002703</td>\n",
       "      <td>0.001883</td>\n",
       "      <td>0.098925</td>\n",
       "      <td>0.008484</td>\n",
       "      <td>0.014513</td>\n",
       "      <td>0.016385</td>\n",
       "      <td>0.021794</td>\n",
       "      <td>0.068420</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9176143510534135851</th>\n",
       "      <td>0.046426</td>\n",
       "      <td>0.006374</td>\n",
       "      <td>0.013802</td>\n",
       "      <td>0.010265</td>\n",
       "      <td>-0.002538</td>\n",
       "      <td>-0.004453</td>\n",
       "      <td>0.016615</td>\n",
       "      <td>0.023070</td>\n",
       "      <td>0.059582</td>\n",
       "      <td>0.057307</td>\n",
       "      <td>...</td>\n",
       "      <td>0.003667</td>\n",
       "      <td>0.073024</td>\n",
       "      <td>-0.015438</td>\n",
       "      <td>0.001199</td>\n",
       "      <td>-0.005606</td>\n",
       "      <td>-0.000307</td>\n",
       "      <td>0.005250</td>\n",
       "      <td>0.041064</td>\n",
       "      <td>0.030733</td>\n",
       "      <td>0.037113</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9172673334835262304</th>\n",
       "      <td>0.005083</td>\n",
       "      <td>0.000618</td>\n",
       "      <td>0.002845</td>\n",
       "      <td>-0.001103</td>\n",
       "      <td>0.000398</td>\n",
       "      <td>0.000754</td>\n",
       "      <td>0.001346</td>\n",
       "      <td>0.002713</td>\n",
       "      <td>-0.002811</td>\n",
       "      <td>0.003930</td>\n",
       "      <td>...</td>\n",
       "      <td>0.005625</td>\n",
       "      <td>0.019382</td>\n",
       "      <td>0.000544</td>\n",
       "      <td>-0.000992</td>\n",
       "      <td>-0.008110</td>\n",
       "      <td>0.000156</td>\n",
       "      <td>0.003408</td>\n",
       "      <td>0.003614</td>\n",
       "      <td>0.007607</td>\n",
       "      <td>-0.003650</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9171475473795142532</th>\n",
       "      <td>0.024453</td>\n",
       "      <td>-0.000761</td>\n",
       "      <td>0.000963</td>\n",
       "      <td>-0.002817</td>\n",
       "      <td>0.002466</td>\n",
       "      <td>0.001215</td>\n",
       "      <td>0.009339</td>\n",
       "      <td>-0.003530</td>\n",
       "      <td>-0.007137</td>\n",
       "      <td>0.023221</td>\n",
       "      <td>...</td>\n",
       "      <td>0.009667</td>\n",
       "      <td>0.017163</td>\n",
       "      <td>0.000424</td>\n",
       "      <td>0.000060</td>\n",
       "      <td>-0.016698</td>\n",
       "      <td>0.002045</td>\n",
       "      <td>0.007644</td>\n",
       "      <td>0.000955</td>\n",
       "      <td>0.011074</td>\n",
       "      <td>-0.006657</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-9166778629773133902</th>\n",
       "      <td>0.009159</td>\n",
       "      <td>-0.001999</td>\n",
       "      <td>-0.012644</td>\n",
       "      <td>-0.002021</td>\n",
       "      <td>0.005367</td>\n",
       "      <td>-0.000005</td>\n",
       "      <td>0.002098</td>\n",
       "      <td>0.004806</td>\n",
       "      <td>0.013407</td>\n",
       "      <td>-0.003584</td>\n",
       "      <td>...</td>\n",
       "      <td>0.002485</td>\n",
       "      <td>0.053437</td>\n",
       "      <td>0.000869</td>\n",
       "      <td>-0.003695</td>\n",
       "      <td>0.009582</td>\n",
       "      <td>0.003952</td>\n",
       "      <td>0.003341</td>\n",
       "      <td>-0.007094</td>\n",
       "      <td>0.000663</td>\n",
       "      <td>0.020589</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10 rows × 1140 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                      -9223121837663643404  -9212075797126931087  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670              0.010399             -0.000193   \n",
       "-9216926795620865886              0.000819             -0.000313   \n",
       "-9194572880052200111             -0.017253             -0.002646   \n",
       "-9192549002213406534              0.035081              0.000391   \n",
       "-9190737901804729417              0.019939             -0.004799   \n",
       "-9189659052158407108              0.008661              0.006604   \n",
       "-9176143510534135851              0.046426              0.006374   \n",
       "-9172673334835262304              0.005083              0.000618   \n",
       "-9171475473795142532              0.024453             -0.000761   \n",
       "-9166778629773133902              0.009159             -0.001999   \n",
       "\n",
       "                      -9207251133131336884  -9199575329909162940  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.012547              0.052958   \n",
       "-9216926795620865886              0.006595             -0.000649   \n",
       "-9194572880052200111             -0.005907             -0.003666   \n",
       "-9192549002213406534             -0.029046             -0.007702   \n",
       "-9190737901804729417              0.006684              0.006363   \n",
       "-9189659052158407108              0.001463             -0.002918   \n",
       "-9176143510534135851              0.013802              0.010265   \n",
       "-9172673334835262304              0.002845             -0.001103   \n",
       "-9171475473795142532              0.000963             -0.002817   \n",
       "-9166778629773133902             -0.012644             -0.002021   \n",
       "\n",
       "                      -9196668942822132778  -9188188261933657343  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.010035             -0.005412   \n",
       "-9216926795620865886              0.000151              0.000338   \n",
       "-9194572880052200111              0.021300             -0.001278   \n",
       "-9192549002213406534              0.017615              0.005496   \n",
       "-9190737901804729417             -0.001997              0.002356   \n",
       "-9189659052158407108              0.008551             -0.001637   \n",
       "-9176143510534135851             -0.002538             -0.004453   \n",
       "-9172673334835262304              0.000398              0.000754   \n",
       "-9171475473795142532              0.002466              0.001215   \n",
       "-9166778629773133902              0.005367             -0.000005   \n",
       "\n",
       "                      -9172914609055320039  -9156344805277471150  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.003918              0.049302   \n",
       "-9216926795620865886              0.000197              0.000861   \n",
       "-9194572880052200111              0.029100             -0.014730   \n",
       "-9192549002213406534              0.013435              0.057563   \n",
       "-9190737901804729417              0.003876              0.004118   \n",
       "-9189659052158407108              0.005443              0.002193   \n",
       "-9176143510534135851              0.016615              0.023070   \n",
       "-9172673334835262304              0.001346              0.002713   \n",
       "-9171475473795142532              0.009339             -0.003530   \n",
       "-9166778629773133902              0.002098              0.004806   \n",
       "\n",
       "                      -9120685872592674274  -9109785559521267180  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.013458             -0.020052   \n",
       "-9216926795620865886              0.002341              0.001765   \n",
       "-9194572880052200111             -0.023410              0.004950   \n",
       "-9192549002213406534              0.047532              0.004209   \n",
       "-9190737901804729417             -0.027098              0.019793   \n",
       "-9189659052158407108              0.023148              0.021311   \n",
       "-9176143510534135851              0.059582              0.057307   \n",
       "-9172673334835262304             -0.002811              0.003930   \n",
       "-9171475473795142532             -0.007137              0.023221   \n",
       "-9166778629773133902              0.013407             -0.003584   \n",
       "\n",
       "                              ...            9105269044962898535  \\\n",
       "contentId                     ...                                  \n",
       "-9222795471790223670          ...                      -0.005306   \n",
       "-9216926795620865886          ...                       0.000095   \n",
       "-9194572880052200111          ...                       0.011529   \n",
       "-9192549002213406534          ...                       0.020149   \n",
       "-9190737901804729417          ...                       0.003719   \n",
       "-9189659052158407108          ...                       0.024496   \n",
       "-9176143510534135851          ...                       0.003667   \n",
       "-9172673334835262304          ...                       0.005625   \n",
       "-9171475473795142532          ...                       0.009667   \n",
       "-9166778629773133902          ...                       0.002485   \n",
       "\n",
       "                       9109075639526981934   9135582630122950040  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.089463             -0.000048   \n",
       "-9216926795620865886              0.013915              0.000506   \n",
       "-9194572880052200111              0.046012              0.010485   \n",
       "-9192549002213406534              0.260317              0.007923   \n",
       "-9190737901804729417              0.004478              0.001917   \n",
       "-9189659052158407108              0.090091             -0.002703   \n",
       "-9176143510534135851              0.073024             -0.015438   \n",
       "-9172673334835262304              0.019382              0.000544   \n",
       "-9171475473795142532              0.017163              0.000424   \n",
       "-9166778629773133902              0.053437              0.000869   \n",
       "\n",
       "                       9137372837662939523   9148269800512008413  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670              0.015023              0.020953   \n",
       "-9216926795620865886              0.001460              0.014863   \n",
       "-9194572880052200111              0.018768              0.150362   \n",
       "-9192549002213406534             -0.008079              0.034164   \n",
       "-9190737901804729417              0.000341             -0.034535   \n",
       "-9189659052158407108              0.001883              0.098925   \n",
       "-9176143510534135851              0.001199             -0.005606   \n",
       "-9172673334835262304             -0.000992             -0.008110   \n",
       "-9171475473795142532              0.000060             -0.016698   \n",
       "-9166778629773133902             -0.003695              0.009582   \n",
       "\n",
       "                       9165571805999894845   9187866633451383747  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.009394             -0.019114   \n",
       "-9216926795620865886              0.000940              0.002391   \n",
       "-9194572880052200111              0.019052              0.023870   \n",
       "-9192549002213406534              0.011558              0.013793   \n",
       "-9190737901804729417             -0.001160              0.001307   \n",
       "-9189659052158407108              0.008484              0.014513   \n",
       "-9176143510534135851             -0.000307              0.005250   \n",
       "-9172673334835262304              0.000156              0.003408   \n",
       "-9171475473795142532              0.002045              0.007644   \n",
       "-9166778629773133902              0.003952              0.003341   \n",
       "\n",
       "                       9191849144618614467   9199170757466086545  \\\n",
       "contentId                                                          \n",
       "-9222795471790223670             -0.029954             -0.018455   \n",
       "-9216926795620865886              0.008057              0.004670   \n",
       "-9194572880052200111             -0.018463              0.012196   \n",
       "-9192549002213406534             -0.010138              0.025703   \n",
       "-9190737901804729417              0.002957              0.005991   \n",
       "-9189659052158407108              0.016385              0.021794   \n",
       "-9176143510534135851              0.041064              0.030733   \n",
       "-9172673334835262304              0.003614              0.007607   \n",
       "-9171475473795142532              0.000955              0.011074   \n",
       "-9166778629773133902             -0.007094              0.000663   \n",
       "\n",
       "                       9210530975708218054  \n",
       "contentId                                   \n",
       "-9222795471790223670             -0.015064  \n",
       "-9216926795620865886              0.003277  \n",
       "-9194572880052200111              0.133913  \n",
       "-9192549002213406534              0.095753  \n",
       "-9190737901804729417             -0.015662  \n",
       "-9189659052158407108              0.068420  \n",
       "-9176143510534135851              0.037113  \n",
       "-9172673334835262304             -0.003650  \n",
       "-9171475473795142532             -0.006657  \n",
       "-9166778629773133902              0.020589  \n",
       "\n",
       "[10 rows x 1140 columns]"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\n",
    "\n",
    "#Converting the reconstructed matrix back to a Pandas dataframe\n",
    "cf_preds_df = pd.DataFrame(all_user_predicted_ratings, columns = users_items_pivot_matrix_df.columns, index=users_ids).transpose()\n",
    "cf_preds_df.head(10)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "1140"
      ]
     },
     "execution_count": 35,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(cf_preds_df.columns)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "class CFRecommender:\n",
    "    \n",
    "    MODEL_NAME = 'Collaborative Filtering'\n",
    "    \n",
    "    def __init__(self, cf_predictions_df, items_df=None):\n",
    "        self.cf_predictions_df = cf_predictions_df\n",
    "        self.items_df = items_df\n",
    "        \n",
    "    def get_model_name(self):\n",
    "        return self.MODEL_NAME\n",
    "        \n",
    "    def recommend_items(self, user_id, items_to_ignore=[], topn=10, verbose=False):\n",
    "        # Get and sort the user's predictions\n",
    "        sorted_user_predictions = self.cf_predictions_df[user_id].sort_values(ascending=False) \\\n",
    "                                    .reset_index().rename(columns={user_id: 'recStrength'})\n",
    "\n",
    "        # Recommend the highest predicted rating movies that the user hasn't seen yet.\n",
    "        recommendations_df = sorted_user_predictions[~sorted_user_predictions['contentId'].isin(items_to_ignore)] \\\n",
    "                               .sort_values('recStrength', ascending = False) \\\n",
    "                               .head(topn)\n",
    "\n",
    "        if verbose:\n",
    "            if self.items_df is None:\n",
    "                raise Exception('\"items_df\" is required in verbose mode')\n",
    "\n",
    "            recommendations_df = recommendations_df.merge(self.items_df, how = 'left', \n",
    "                                                          left_on = 'contentId', \n",
    "                                                          right_on = 'contentId')[['recStrength', 'contentId', 'title', 'url', 'lang']]\n",
    "\n",
    "\n",
    "        return recommendations_df\n",
    "    \n",
    "cf_recommender_model = CFRecommender(cf_preds_df, articles_df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Evaluating Collaborative Filtering (SVD Matrix Factorization) model...\n",
      "1139 users processed\n",
      "\n",
      "Global metrics:\n",
      "{'recall@10': 0.46624904116594224, 'recall@5': 0.3307338276655587, 'modelName': 'Collaborative Filtering'}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>_person_id</th>\n",
       "      <th>hits@10_count</th>\n",
       "      <th>hits@5_count</th>\n",
       "      <th>interacted_count</th>\n",
       "      <th>recall@10</th>\n",
       "      <th>recall@5</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>76</th>\n",
       "      <td>3609194402293569455</td>\n",
       "      <td>43</td>\n",
       "      <td>22</td>\n",
       "      <td>192</td>\n",
       "      <td>0.223958</td>\n",
       "      <td>0.114583</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>-2626634673110551643</td>\n",
       "      <td>54</td>\n",
       "      <td>30</td>\n",
       "      <td>134</td>\n",
       "      <td>0.402985</td>\n",
       "      <td>0.223881</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>-1032019229384696495</td>\n",
       "      <td>34</td>\n",
       "      <td>18</td>\n",
       "      <td>130</td>\n",
       "      <td>0.261538</td>\n",
       "      <td>0.138462</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>-1443636648652872475</td>\n",
       "      <td>51</td>\n",
       "      <td>38</td>\n",
       "      <td>117</td>\n",
       "      <td>0.435897</td>\n",
       "      <td>0.324786</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>82</th>\n",
       "      <td>-2979881261169775358</td>\n",
       "      <td>48</td>\n",
       "      <td>37</td>\n",
       "      <td>88</td>\n",
       "      <td>0.545455</td>\n",
       "      <td>0.420455</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>161</th>\n",
       "      <td>-3596626804281480007</td>\n",
       "      <td>35</td>\n",
       "      <td>22</td>\n",
       "      <td>80</td>\n",
       "      <td>0.437500</td>\n",
       "      <td>0.275000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>1116121227607581999</td>\n",
       "      <td>32</td>\n",
       "      <td>21</td>\n",
       "      <td>73</td>\n",
       "      <td>0.438356</td>\n",
       "      <td>0.287671</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>81</th>\n",
       "      <td>692689608292948411</td>\n",
       "      <td>23</td>\n",
       "      <td>13</td>\n",
       "      <td>69</td>\n",
       "      <td>0.333333</td>\n",
       "      <td>0.188406</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>106</th>\n",
       "      <td>-9016528795238256703</td>\n",
       "      <td>30</td>\n",
       "      <td>17</td>\n",
       "      <td>69</td>\n",
       "      <td>0.434783</td>\n",
       "      <td>0.246377</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>3636910968448833585</td>\n",
       "      <td>31</td>\n",
       "      <td>18</td>\n",
       "      <td>68</td>\n",
       "      <td>0.455882</td>\n",
       "      <td>0.264706</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              _person_id  hits@10_count  hits@5_count  interacted_count  \\\n",
       "76   3609194402293569455             43            22               192   \n",
       "17  -2626634673110551643             54            30               134   \n",
       "16  -1032019229384696495             34            18               130   \n",
       "10  -1443636648652872475             51            38               117   \n",
       "82  -2979881261169775358             48            37                88   \n",
       "161 -3596626804281480007             35            22                80   \n",
       "65   1116121227607581999             32            21                73   \n",
       "81    692689608292948411             23            13                69   \n",
       "106 -9016528795238256703             30            17                69   \n",
       "52   3636910968448833585             31            18                68   \n",
       "\n",
       "     recall@10  recall@5  \n",
       "76    0.223958  0.114583  \n",
       "17    0.402985  0.223881  \n",
       "16    0.261538  0.138462  \n",
       "10    0.435897  0.324786  \n",
       "82    0.545455  0.420455  \n",
       "161   0.437500  0.275000  \n",
       "65    0.438356  0.287671  \n",
       "81    0.333333  0.188406  \n",
       "106   0.434783  0.246377  \n",
       "52    0.455882  0.264706  "
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print('Evaluating Collaborative Filtering (SVD Matrix Factorization) model...')\n",
    "cf_global_metrics, cf_detailed_results_df = model_evaluator.evaluate_model(cf_recommender_model)\n",
    "print('\\nGlobal metrics:\\n%s' % cf_global_metrics)\n",
    "cf_detailed_results_df.head(10)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "\n",
    "class HybridRecommender:\n",
    "    \n",
    "    MODEL_NAME = 'Hybrid'\n",
    "    \n",
    "    def __init__(self, cb_rec_model, cf_rec_model, items_df):\n",
    "        self.cb_rec_model = cb_rec_model\n",
    "        self.cf_rec_model = cf_rec_model\n",
    "        self.items_df = items_df\n",
    "        \n",
    "    def get_model_name(self):\n",
    "        return self.MODEL_NAME\n",
    "        \n",
    "    def recommend_items(self, user_id, items_to_ignore=[], topn=10, verbose=False):\n",
    "        #Getting the top-1000 Content-based filtering recommendations\n",
    "        cb_recs_df = self.cb_rec_model.recommend_items(user_id, items_to_ignore=items_to_ignore, verbose=verbose,\n",
    "                                                           topn=1000).rename(columns={'recStrength': 'recStrengthCB'})\n",
    "        \n",
    "        #Getting the top-1000 Collaborative filtering recommendations\n",
    "        cf_recs_df = self.cf_rec_model.recommend_items(user_id, items_to_ignore=items_to_ignore, verbose=verbose, \n",
    "                                                           topn=1000).rename(columns={'recStrength': 'recStrengthCF'})\n",
    "        \n",
    "        #Combining the results by contentId\n",
    "        recs_df = cb_recs_df.merge(cf_recs_df,\n",
    "                                   how = 'inner', \n",
    "                                   left_on = 'contentId', \n",
    "                                   right_on = 'contentId')\n",
    "        \n",
    "        #Computing a hybrid recommendation score based on CF and CB scores\n",
    "        recs_df['recStrengthHybrid'] = recs_df['recStrengthCB'] * recs_df['recStrengthCF']\n",
    "        \n",
    "        #Sorting recommendations by hybrid score\n",
    "        recommendations_df = recs_df.sort_values('recStrengthHybrid', ascending=False).head(topn)\n",
    "\n",
    "        if verbose:\n",
    "            if self.items_df is None:\n",
    "                raise Exception('\"items_df\" is required in verbose mode')\n",
    "\n",
    "            recommendations_df = recommendations_df.merge(self.items_df, how = 'left', \n",
    "                                                          left_on = 'contentId', \n",
    "                                                          right_on = 'contentId')[['recStrengthHybrid', 'contentId', 'title', 'url', 'lang']]\n",
    "\n",
    "\n",
    "        return recommendations_df\n",
    "    \n",
    "hybrid_recommender_model = HybridRecommender(content_based_recommender_model, cf_recommender_model, articles_df)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Evaluating Hybrid model...\n",
      "1139 users processed\n",
      "\n",
      "Global metrics:\n",
      "{'recall@10': 0.54129378675530559, 'recall@5': 0.43492712861160826, 'modelName': 'Hybrid'}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>_person_id</th>\n",
       "      <th>hits@10_count</th>\n",
       "      <th>hits@5_count</th>\n",
       "      <th>interacted_count</th>\n",
       "      <th>recall@10</th>\n",
       "      <th>recall@5</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>76</th>\n",
       "      <td>3609194402293569455</td>\n",
       "      <td>41</td>\n",
       "      <td>29</td>\n",
       "      <td>192</td>\n",
       "      <td>0.213542</td>\n",
       "      <td>0.151042</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>-2626634673110551643</td>\n",
       "      <td>54</td>\n",
       "      <td>39</td>\n",
       "      <td>134</td>\n",
       "      <td>0.402985</td>\n",
       "      <td>0.291045</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>-1032019229384696495</td>\n",
       "      <td>36</td>\n",
       "      <td>27</td>\n",
       "      <td>130</td>\n",
       "      <td>0.276923</td>\n",
       "      <td>0.207692</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>-1443636648652872475</td>\n",
       "      <td>52</td>\n",
       "      <td>36</td>\n",
       "      <td>117</td>\n",
       "      <td>0.444444</td>\n",
       "      <td>0.307692</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>82</th>\n",
       "      <td>-2979881261169775358</td>\n",
       "      <td>31</td>\n",
       "      <td>25</td>\n",
       "      <td>88</td>\n",
       "      <td>0.352273</td>\n",
       "      <td>0.284091</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>161</th>\n",
       "      <td>-3596626804281480007</td>\n",
       "      <td>29</td>\n",
       "      <td>22</td>\n",
       "      <td>80</td>\n",
       "      <td>0.362500</td>\n",
       "      <td>0.275000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>1116121227607581999</td>\n",
       "      <td>23</td>\n",
       "      <td>14</td>\n",
       "      <td>73</td>\n",
       "      <td>0.315068</td>\n",
       "      <td>0.191781</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>81</th>\n",
       "      <td>692689608292948411</td>\n",
       "      <td>22</td>\n",
       "      <td>18</td>\n",
       "      <td>69</td>\n",
       "      <td>0.318841</td>\n",
       "      <td>0.260870</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>106</th>\n",
       "      <td>-9016528795238256703</td>\n",
       "      <td>18</td>\n",
       "      <td>14</td>\n",
       "      <td>69</td>\n",
       "      <td>0.260870</td>\n",
       "      <td>0.202899</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>3636910968448833585</td>\n",
       "      <td>20</td>\n",
       "      <td>15</td>\n",
       "      <td>68</td>\n",
       "      <td>0.294118</td>\n",
       "      <td>0.220588</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              _person_id  hits@10_count  hits@5_count  interacted_count  \\\n",
       "76   3609194402293569455             41            29               192   \n",
       "17  -2626634673110551643             54            39               134   \n",
       "16  -1032019229384696495             36            27               130   \n",
       "10  -1443636648652872475             52            36               117   \n",
       "82  -2979881261169775358             31            25                88   \n",
       "161 -3596626804281480007             29            22                80   \n",
       "65   1116121227607581999             23            14                73   \n",
       "81    692689608292948411             22            18                69   \n",
       "106 -9016528795238256703             18            14                69   \n",
       "52   3636910968448833585             20            15                68   \n",
       "\n",
       "     recall@10  recall@5  \n",
       "76    0.213542  0.151042  \n",
       "17    0.402985  0.291045  \n",
       "16    0.276923  0.207692  \n",
       "10    0.444444  0.307692  \n",
       "82    0.352273  0.284091  \n",
       "161   0.362500  0.275000  \n",
       "65    0.315068  0.191781  \n",
       "81    0.318841  0.260870  \n",
       "106   0.260870  0.202899  \n",
       "52    0.294118  0.220588  "
      ]
     },
     "execution_count": 39,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print('Evaluating Hybrid model...')\n",
    "hybrid_global_metrics, hybrid_detailed_results_df = model_evaluator.evaluate_model(hybrid_recommender_model)\n",
    "print('\\nGlobal metrics:\\n%s' % hybrid_global_metrics)\n",
    "hybrid_detailed_results_df.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>recall@10</th>\n",
       "      <th>recall@5</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>modelName</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Popularity</th>\n",
       "      <td>0.371388</td>\n",
       "      <td>0.243160</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Collaborative Filtering</th>\n",
       "      <td>0.466249</td>\n",
       "      <td>0.330734</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Content-Based</th>\n",
       "      <td>0.524290</td>\n",
       "      <td>0.414856</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Hybrid</th>\n",
       "      <td>0.541294</td>\n",
       "      <td>0.434927</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                         recall@10  recall@5\n",
       "modelName                                   \n",
       "Popularity                0.371388  0.243160\n",
       "Collaborative Filtering   0.466249  0.330734\n",
       "Content-Based             0.524290  0.414856\n",
       "Hybrid                    0.541294  0.434927"
      ]
     },
     "execution_count": 40,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "global_metrics_df = pd.DataFrame([pop_global_metrics, cf_global_metrics, cb_global_metrics, hybrid_global_metrics]) \\\n",
    "                        .set_index('modelName')\n",
    "global_metrics_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 1080x576 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "%matplotlib inline\n",
    "ax = global_metrics_df.transpose().plot(kind='bar', figsize=(15,8))\n",
    "for p in ax.patches:\n",
    "    ax.annotate(\"%.3f\" % p.get_height(), (p.get_x() + p.get_width() / 2., p.get_height()), ha='center', va='center', xytext=(0, 10), textcoords='offset points')\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "def inspect_interactions(person_id, test_set=True):\n",
    "    if test_set:\n",
    "        interactions_df = interactions_test_indexed_df\n",
    "    else:\n",
    "        interactions_df = interactions_train_indexed_df\n",
    "    return interactions_df.loc[person_id].merge(articles_df, how = 'left', \n",
    "                                                      left_on = 'contentId', \n",
    "                                                      right_on = 'contentId') \\\n",
    "                          .sort_values('eventStrength', ascending = False)[['eventStrength', \n",
    "                                                                          'contentId',\n",
    "                                                                          'title', 'url', 'lang']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>eventStrength</th>\n",
       "      <th>contentId</th>\n",
       "      <th>title</th>\n",
       "      <th>url</th>\n",
       "      <th>lang</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>115</th>\n",
       "      <td>4.285402</td>\n",
       "      <td>7342707578347442862</td>\n",
       "      <td>At eBay, Machine Learning is Driving Innovativ...</td>\n",
       "      <td>https://www.ebayinc.com/stories/news/at-ebay-m...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>4.129283</td>\n",
       "      <td>621816023396605502</td>\n",
       "      <td>AI Is Here to Help You Write Emails People Wil...</td>\n",
       "      <td>http://www.wired.com/2016/08/boomerang-using-a...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>4.044394</td>\n",
       "      <td>-4460374799273064357</td>\n",
       "      <td>Deep Learning for Chatbots, Part 1 - Introduction</td>\n",
       "      <td>http://www.wildml.com/2016/04/deep-learning-fo...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>116</th>\n",
       "      <td>3.954196</td>\n",
       "      <td>-7959318068735027467</td>\n",
       "      <td>Auto-scaling scikit-learn with Spark</td>\n",
       "      <td>https://databricks.com/blog/2016/02/08/auto-sc...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>3.906891</td>\n",
       "      <td>2589533162305407436</td>\n",
       "      <td>6 reasons why I like KeystoneML</td>\n",
       "      <td>http://radar.oreilly.com/2015/07/6-reasons-why...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>3.700440</td>\n",
       "      <td>5258604889412591249</td>\n",
       "      <td>Machine Learning Is No Longer Just for Experts</td>\n",
       "      <td>https://hbr.org/2016/10/machine-learning-is-no...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>3.700440</td>\n",
       "      <td>-398780385766545248</td>\n",
       "      <td>10 Stats About Artificial Intelligence That Wi...</td>\n",
       "      <td>http://www.fool.com/investing/2016/06/19/10-st...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>113</th>\n",
       "      <td>3.643856</td>\n",
       "      <td>-6467708104873171151</td>\n",
       "      <td>5 reasons your employees aren't sharing their ...</td>\n",
       "      <td>http://justcuriousblog.com/2016/04/5-reasons-y...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42</th>\n",
       "      <td>3.523562</td>\n",
       "      <td>-4944551138301474550</td>\n",
       "      <td>Algorithms and architecture for job recommenda...</td>\n",
       "      <td>https://www.oreilly.com/ideas/algorithms-and-a...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>43</th>\n",
       "      <td>3.459432</td>\n",
       "      <td>-8377626164558006982</td>\n",
       "      <td>Bad Writing Is Destroying Your Company's Produ...</td>\n",
       "      <td>https://hbr.org/2016/09/bad-writing-is-destroy...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>3.459432</td>\n",
       "      <td>444378495316508239</td>\n",
       "      <td>How to choose algorithms for Microsoft Azure M...</td>\n",
       "      <td>https://azure.microsoft.com/en-us/documentatio...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3.321928</td>\n",
       "      <td>2468005329717107277</td>\n",
       "      <td>How Netflix does A/B Testing - uxdesign.cc - U...</td>\n",
       "      <td>https://uxdesign.cc/how-netflix-does-a-b-testi...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>101</th>\n",
       "      <td>3.321928</td>\n",
       "      <td>-8085935119790093311</td>\n",
       "      <td>Graph Capabilities with the Elastic Stack</td>\n",
       "      <td>https://www.elastic.co/webinars/sneak-peek-of-...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>107</th>\n",
       "      <td>3.169925</td>\n",
       "      <td>-1429167743746492970</td>\n",
       "      <td>Building with Watson Technical Web Series</td>\n",
       "      <td>https://www-304.ibm.com/partnerworld/wps/servl...</td>\n",
       "      <td>pt</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>3.169925</td>\n",
       "      <td>6340108943344143104</td>\n",
       "      <td>Text summarization with TensorFlow</td>\n",
       "      <td>https://research.googleblog.com/2016/08/text-s...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>49</th>\n",
       "      <td>3.169925</td>\n",
       "      <td>1525777409079968377</td>\n",
       "      <td>Probabilistic Programming</td>\n",
       "      <td>http://probabilistic-programming.org/wiki/Home</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>3.169925</td>\n",
       "      <td>-5756697018315640725</td>\n",
       "      <td>Being A Developer After 40 - Free Code Camp</td>\n",
       "      <td>https://medium.freecodecamp.com/being-a-develo...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>97</th>\n",
       "      <td>3.087463</td>\n",
       "      <td>2623290164732957912</td>\n",
       "      <td>Creative Applications of Deep Learning with Te...</td>\n",
       "      <td>https://www.kadenze.com/courses/creative-appli...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>3.000000</td>\n",
       "      <td>279771472506428952</td>\n",
       "      <td>5 Unique Features Of Google Compute Engine Tha...</td>\n",
       "      <td>http://www.forbes.com/sites/janakirammsv/2016/...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>78</th>\n",
       "      <td>2.906891</td>\n",
       "      <td>-3920124114454832425</td>\n",
       "      <td>Worldwide Ops in Minutes with DataStax &amp; Cloud</td>\n",
       "      <td>http://www.datastax.com/2016/01/datastax-enter...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     eventStrength            contentId  \\\n",
       "115       4.285402  7342707578347442862   \n",
       "38        4.129283   621816023396605502   \n",
       "8         4.044394 -4460374799273064357   \n",
       "116       3.954196 -7959318068735027467   \n",
       "10        3.906891  2589533162305407436   \n",
       "28        3.700440  5258604889412591249   \n",
       "6         3.700440  -398780385766545248   \n",
       "113       3.643856 -6467708104873171151   \n",
       "42        3.523562 -4944551138301474550   \n",
       "43        3.459432 -8377626164558006982   \n",
       "41        3.459432   444378495316508239   \n",
       "3         3.321928  2468005329717107277   \n",
       "101       3.321928 -8085935119790093311   \n",
       "107       3.169925 -1429167743746492970   \n",
       "16        3.169925  6340108943344143104   \n",
       "49        3.169925  1525777409079968377   \n",
       "44        3.169925 -5756697018315640725   \n",
       "97        3.087463  2623290164732957912   \n",
       "32        3.000000   279771472506428952   \n",
       "78        2.906891 -3920124114454832425   \n",
       "\n",
       "                                                 title  \\\n",
       "115  At eBay, Machine Learning is Driving Innovativ...   \n",
       "38   AI Is Here to Help You Write Emails People Wil...   \n",
       "8    Deep Learning for Chatbots, Part 1 - Introduction   \n",
       "116               Auto-scaling scikit-learn with Spark   \n",
       "10                     6 reasons why I like KeystoneML   \n",
       "28      Machine Learning Is No Longer Just for Experts   \n",
       "6    10 Stats About Artificial Intelligence That Wi...   \n",
       "113  5 reasons your employees aren't sharing their ...   \n",
       "42   Algorithms and architecture for job recommenda...   \n",
       "43   Bad Writing Is Destroying Your Company's Produ...   \n",
       "41   How to choose algorithms for Microsoft Azure M...   \n",
       "3    How Netflix does A/B Testing - uxdesign.cc - U...   \n",
       "101          Graph Capabilities with the Elastic Stack   \n",
       "107          Building with Watson Technical Web Series   \n",
       "16                  Text summarization with TensorFlow   \n",
       "49                           Probabilistic Programming   \n",
       "44         Being A Developer After 40 - Free Code Camp   \n",
       "97   Creative Applications of Deep Learning with Te...   \n",
       "32   5 Unique Features Of Google Compute Engine Tha...   \n",
       "78      Worldwide Ops in Minutes with DataStax & Cloud   \n",
       "\n",
       "                                                   url lang  \n",
       "115  https://www.ebayinc.com/stories/news/at-ebay-m...   en  \n",
       "38   http://www.wired.com/2016/08/boomerang-using-a...   en  \n",
       "8    http://www.wildml.com/2016/04/deep-learning-fo...   en  \n",
       "116  https://databricks.com/blog/2016/02/08/auto-sc...   en  \n",
       "10   http://radar.oreilly.com/2015/07/6-reasons-why...   en  \n",
       "28   https://hbr.org/2016/10/machine-learning-is-no...   en  \n",
       "6    http://www.fool.com/investing/2016/06/19/10-st...   en  \n",
       "113  http://justcuriousblog.com/2016/04/5-reasons-y...   en  \n",
       "42   https://www.oreilly.com/ideas/algorithms-and-a...   en  \n",
       "43   https://hbr.org/2016/09/bad-writing-is-destroy...   en  \n",
       "41   https://azure.microsoft.com/en-us/documentatio...   en  \n",
       "3    https://uxdesign.cc/how-netflix-does-a-b-testi...   en  \n",
       "101  https://www.elastic.co/webinars/sneak-peek-of-...   en  \n",
       "107  https://www-304.ibm.com/partnerworld/wps/servl...   pt  \n",
       "16   https://research.googleblog.com/2016/08/text-s...   en  \n",
       "49      http://probabilistic-programming.org/wiki/Home   en  \n",
       "44   https://medium.freecodecamp.com/being-a-develo...   en  \n",
       "97   https://www.kadenze.com/courses/creative-appli...   en  \n",
       "32   http://www.forbes.com/sites/janakirammsv/2016/...   en  \n",
       "78   http://www.datastax.com/2016/01/datastax-enter...   en  "
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "inspect_interactions(-1479311724257856983, test_set=False).head(20)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>recStrengthHybrid</th>\n",
       "      <th>contentId</th>\n",
       "      <th>title</th>\n",
       "      <th>url</th>\n",
       "      <th>lang</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0.484696</td>\n",
       "      <td>3269302169678465882</td>\n",
       "      <td>The barbell effect of machine learning.</td>\n",
       "      <td>http://techcrunch.com/2016/06/02/the-barbell-e...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0.428711</td>\n",
       "      <td>5092635400707338872</td>\n",
       "      <td>Power to the People: How One Unknown Group of ...</td>\n",
       "      <td>https://medium.com/@atduskgreg/power-to-the-pe...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0.411263</td>\n",
       "      <td>5258604889412591249</td>\n",
       "      <td>Machine Learning Is No Longer Just for Experts</td>\n",
       "      <td>https://hbr.org/2016/10/machine-learning-is-no...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0.358686</td>\n",
       "      <td>-9033211547111606164</td>\n",
       "      <td>Google's Cloud Machine Learning service is now...</td>\n",
       "      <td>https://techcrunch.com/2016/09/29/googles-clou...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0.335053</td>\n",
       "      <td>5250363310227021277</td>\n",
       "      <td>How Google is Remaking Itself as a \"Machine Le...</td>\n",
       "      <td>https://backchannel.com/how-google-is-remaking...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0.316371</td>\n",
       "      <td>-7126520323752764957</td>\n",
       "      <td>How Google is Remaking Itself as a \"Machine Le...</td>\n",
       "      <td>https://backchannel.com/how-google-is-remaking...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>0.316029</td>\n",
       "      <td>7395435905985567130</td>\n",
       "      <td>The AI business landscape</td>\n",
       "      <td>https://www.oreilly.com/ideas/the-ai-business-...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>0.309052</td>\n",
       "      <td>-5756697018315640725</td>\n",
       "      <td>Being A Developer After 40 - Free Code Camp</td>\n",
       "      <td>https://medium.freecodecamp.com/being-a-develo...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>0.295994</td>\n",
       "      <td>-8190931845319543363</td>\n",
       "      <td>Machine Learning Is At The Very Peak Of Its Hy...</td>\n",
       "      <td>https://arc.applause.com/2016/08/17/gartner-hy...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>0.294210</td>\n",
       "      <td>1415230502586719648</td>\n",
       "      <td>Machine Learning Is Redefining The Enterprise ...</td>\n",
       "      <td>http://www.forbes.com/sites/louiscolumbus/2016...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>0.285358</td>\n",
       "      <td>621816023396605502</td>\n",
       "      <td>AI Is Here to Help You Write Emails People Wil...</td>\n",
       "      <td>http://www.wired.com/2016/08/boomerang-using-a...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>0.282778</td>\n",
       "      <td>201515581783532281</td>\n",
       "      <td>CrowdFlower raises $10 million from Microsoft ...</td>\n",
       "      <td>http://venturebeat.com/2016/06/07/crowdflower-...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>0.276266</td>\n",
       "      <td>-4541461982704074404</td>\n",
       "      <td>Exclusive: Why Microsoft is betting its future...</td>\n",
       "      <td>http://www.theverge.com/2016/7/7/12111028/micr...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>0.265704</td>\n",
       "      <td>-9128652074338368262</td>\n",
       "      <td>Clarifying the uses of artificial intelligence...</td>\n",
       "      <td>http://techcrunch.com/2016/05/12/clarifying-th...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>0.260824</td>\n",
       "      <td>8847604225354271039</td>\n",
       "      <td>How to forecast demand with Google BigQuery, p...</td>\n",
       "      <td>https://cloud.google.com/blog/big-data/2016/05...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>0.257225</td>\n",
       "      <td>-5027816744653977347</td>\n",
       "      <td>Apple acquires Turi, a machine learning company</td>\n",
       "      <td>https://techcrunch.com/2016/08/05/apple-acquir...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>0.256248</td>\n",
       "      <td>-5253644367331262405</td>\n",
       "      <td>Hello, TensorFlow!</td>\n",
       "      <td>https://www.oreilly.com/learning/hello-tensorflow</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>0.252939</td>\n",
       "      <td>444378495316508239</td>\n",
       "      <td>How to choose algorithms for Microsoft Azure M...</td>\n",
       "      <td>https://azure.microsoft.com/en-us/documentatio...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>0.246982</td>\n",
       "      <td>1549650080907932816</td>\n",
       "      <td>Spark comparison: AWS vs. GCP</td>\n",
       "      <td>https://www.oreilly.com/ideas/spark-comparison...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>0.241448</td>\n",
       "      <td>-6273159470243757969</td>\n",
       "      <td>This startup uses machine learning and satelli...</td>\n",
       "      <td>http://www.theverge.com/2016/8/4/12369494/desc...</td>\n",
       "      <td>en</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    recStrengthHybrid            contentId  \\\n",
       "0            0.484696  3269302169678465882   \n",
       "1            0.428711  5092635400707338872   \n",
       "2            0.411263  5258604889412591249   \n",
       "3            0.358686 -9033211547111606164   \n",
       "4            0.335053  5250363310227021277   \n",
       "5            0.316371 -7126520323752764957   \n",
       "6            0.316029  7395435905985567130   \n",
       "7            0.309052 -5756697018315640725   \n",
       "8            0.295994 -8190931845319543363   \n",
       "9            0.294210  1415230502586719648   \n",
       "10           0.285358   621816023396605502   \n",
       "11           0.282778   201515581783532281   \n",
       "12           0.276266 -4541461982704074404   \n",
       "13           0.265704 -9128652074338368262   \n",
       "14           0.260824  8847604225354271039   \n",
       "15           0.257225 -5027816744653977347   \n",
       "16           0.256248 -5253644367331262405   \n",
       "17           0.252939   444378495316508239   \n",
       "18           0.246982  1549650080907932816   \n",
       "19           0.241448 -6273159470243757969   \n",
       "\n",
       "                                                title  \\\n",
       "0             The barbell effect of machine learning.   \n",
       "1   Power to the People: How One Unknown Group of ...   \n",
       "2      Machine Learning Is No Longer Just for Experts   \n",
       "3   Google's Cloud Machine Learning service is now...   \n",
       "4   How Google is Remaking Itself as a \"Machine Le...   \n",
       "5   How Google is Remaking Itself as a \"Machine Le...   \n",
       "6                           The AI business landscape   \n",
       "7         Being A Developer After 40 - Free Code Camp   \n",
       "8   Machine Learning Is At The Very Peak Of Its Hy...   \n",
       "9   Machine Learning Is Redefining The Enterprise ...   \n",
       "10  AI Is Here to Help You Write Emails People Wil...   \n",
       "11  CrowdFlower raises $10 million from Microsoft ...   \n",
       "12  Exclusive: Why Microsoft is betting its future...   \n",
       "13  Clarifying the uses of artificial intelligence...   \n",
       "14  How to forecast demand with Google BigQuery, p...   \n",
       "15    Apple acquires Turi, a machine learning company   \n",
       "16                                 Hello, TensorFlow!   \n",
       "17  How to choose algorithms for Microsoft Azure M...   \n",
       "18                      Spark comparison: AWS vs. GCP   \n",
       "19  This startup uses machine learning and satelli...   \n",
       "\n",
       "                                                  url lang  \n",
       "0   http://techcrunch.com/2016/06/02/the-barbell-e...   en  \n",
       "1   https://medium.com/@atduskgreg/power-to-the-pe...   en  \n",
       "2   https://hbr.org/2016/10/machine-learning-is-no...   en  \n",
       "3   https://techcrunch.com/2016/09/29/googles-clou...   en  \n",
       "4   https://backchannel.com/how-google-is-remaking...   en  \n",
       "5   https://backchannel.com/how-google-is-remaking...   en  \n",
       "6   https://www.oreilly.com/ideas/the-ai-business-...   en  \n",
       "7   https://medium.freecodecamp.com/being-a-develo...   en  \n",
       "8   https://arc.applause.com/2016/08/17/gartner-hy...   en  \n",
       "9   http://www.forbes.com/sites/louiscolumbus/2016...   en  \n",
       "10  http://www.wired.com/2016/08/boomerang-using-a...   en  \n",
       "11  http://venturebeat.com/2016/06/07/crowdflower-...   en  \n",
       "12  http://www.theverge.com/2016/7/7/12111028/micr...   en  \n",
       "13  http://techcrunch.com/2016/05/12/clarifying-th...   en  \n",
       "14  https://cloud.google.com/blog/big-data/2016/05...   en  \n",
       "15  https://techcrunch.com/2016/08/05/apple-acquir...   en  \n",
       "16  https://www.oreilly.com/learning/hello-tensorflow   en  \n",
       "17  https://azure.microsoft.com/en-us/documentatio...   en  \n",
       "18  https://www.oreilly.com/ideas/spark-comparison...   en  \n",
       "19  http://www.theverge.com/2016/8/4/12369494/desc...   en  "
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "hybrid_recommender_model.recommend_items(-1479311724257856983, topn=20, verbose=True)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.4.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
